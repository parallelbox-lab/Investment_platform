<?php/*$json_url = "http://api.ebulksms.com/sendsms.json";$xml_url = "http://api.ebulksms.com/sendsms.xml";$userkey = '';$apikey = ''; if($_POST[])$userkey = 'ecampus@fuoye.edu.ng';$apikey = '5c62b0ff24cdc5f5bd2d1234c7af44486ab69786';   $sendername = substr($_POST['sender_name'], 0, 11);   $recipients = $_POST['telephone'];   $message = $_POST['message'];    $flash = 0;    if (get_magic_quotes_gpc()) {        $message = stripslashes($_POST['message']);    }    $message = substr($_POST['message'], 0, 160);#Use the next line for HTTP POST with JSON    echo $result = useJSON($json_url, $userkey, $apikey, $flash, $sendername, $message, $recipients);#Uncomment the next line and comment the one above if you want to use HTTP POST with XML    //$result = useXML($xml_url, $userkey, $apikey, $flash, $sendername, $message, $recipients);////////EBULK SMS API CODE///function useJSON($url, $userkey, $apikey, $flash, $sendername, $messagetext, $recipients) {    $gsm = array();    $country_code = '234';    $arr_recipient = explode(',', $recipients);    foreach ($arr_recipient as $recipient) {        $mobilenumber = trim($recipient);        if (substr($mobilenumber, 0, 1) == '0'){            $mobilenumber = $country_code . substr($mobilenumber, 1);        }        elseif (substr($mobilenumber, 0, 1) == '+'){            $mobilenumber = substr($mobilenumber, 1);        }        $generated_id = uniqid('int_', false);        $generated_id = substr($generated_id, 0, 30);        $gsm['gsm'][] = array('msidn' => $mobilenumber, 'msgid' => $generated_id);    }    $message = array(        'sender' => $sendername,        'messagetext' => $messagetext,        'flash' => "{$flash}",    );     $request = array('SMS' => array(            'auth' => array(                'username' => $userkey,                'apikey' => $apikey            ),            'message' => $message,            'recipients' => $gsm    ));	print_r($request);    $json_data = json_encode($request);    if ($json_data) {        $response = doPostRequest($url, $json_data, array('Content-Type: application/json'));       echo $result = json_decode($response);        return $result->response->status;    } else {        return false;    }} function useXML($url, $userkey, $apikey, $flash, $sendername, $messagetext, $recipients) {    $country_code = '234';    $arr_recipient = explode(',', $recipients);    $count = count($arr_recipient);    $msg_ids = array();    $recipients = '';     $xml = new SimpleXMLElement('<SMS></SMS>');    $auth = $xml->addChild('auth');    $auth->addChild('username', $userkey);    $auth->addChild('apikey', $apikey);     $msg = $xml->addChild('message');    $msg->addChild('sender', $sendername);    $msg->addChild('messagetext', $messagetext);    $msg->addChild('flash', $flash);     $rcpt = $xml->addChild('recipients');    for ($i = 0; $i < $count; $i++) {        $generated_id = uniqid('int_', false);        $generated_id = substr($generated_id, 0, 30);        $mobilenumber = trim($arr_recipient[$i]);        if (substr($mobilenumber, 0, 1) == '0') {            $mobilenumber = $country_code . substr($mobilenumber, 1);        } elseif (substr($mobilenumber, 0, 1) == '+') {            $mobilenumber = substr($mobilenumber, 1);        }        $gsm = $rcpt->addChild('gsm');        $gsm->addchild('msidn', $mobilenumber);        $gsm->addchild('msgid', $generated_id);    }    $xmlrequest = $xml->asXML();     if ($xmlrequest) {        $result = doPostRequest($url, $xmlrequest, array('Content-Type: application/xml'));        $xmlresponse = new SimpleXMLElement($result);        return $xmlresponse->status;    }    return false;} //Function to connect to SMS sending server using HTTP POSTfunction doPostRequest($url, $data, $headers = array('Content-Type: application/x-www-form-urlencoded')) {    $php_errormsg = '';    if (is_array($data)) {        $data = http_build_query($data, '', '&');    }    $params = array('http' => array(            'method' => 'POST',            'content' => $data)    );    if ($headers !== null) {        $params['http']['header'] = $headers;    }    $ctx = stream_context_create($params);    $fp = fopen($url, 'rb', false, $ctx);    if (!$fp) {        return "Error: gateway is inaccessible";    }    //stream_set_timeout($fp, 0, 250);    try {        $response = stream_get_contents($fp);        if ($response === false) {            throw new Exception("Problem reading data from $url, $php_errormsg");        }        return $response;    } catch (Exception $e) {        $response = $e->getMessage();        return $response;    }} */?><?php$json_url = "http://api.ebulksms.com:8080/sendsms.json";$xml_url = "http://api.ebulksms.com:8080/sendsms.xml";$http_get_url = "http://api.ebulksms.com:8080/sendsms";$userkey = '';$apikey = ''; if($roleid==1){$char="306";}else{$char="306";}if ($_POST['do']=="sendsms") {     $userkey = 'ecampus@fuoye.edu.ng';	 $apikey = 'c635779a587f512e3dd15bcbe3182994babf129d';     $sendername = substr($_POST['sender_name'], 0, 11);     $recipients = $_POST['telephone'];     $message = $_POST['message'];    $flash = 0;    if (get_magic_quotes_gpc()) {        $message = stripslashes($_POST['message']);    }    $message = substr($_POST['message'], 0, $char);#Use the next line for HTTP POST with JSON    $result = useJSON($json_url, $userkey, $apikey, $flash, $sendername, $message, $recipients);#Uncomment the next line and comment the one above if you want to use HTTP POST with XML    //$result = useXML($xml_url, $userkey, $apikey, $flash, $sendername, $message, $recipients); #Uncomment the next line and comment the ones above if you want to use simple HTTP GET    //$result = useHTTPGet($http_get_url, $userkey, $apikey, $flash, $sendername, $message, $recipients);	if($result=="SUCCESS"){$success="SMS Message ".$message." sent to ".$recipients." by ". strtoupper($username);	log_activity($username, mysql_escape_string($success), $ipaddress, $refferer, $pagevisited, $useragent);	}else{$error="Failed: SMS Message ".$message." sent to ".$recipients." by ". strtoupper($username);	log_activity($username, mysql_escape_string($error), $ipaddress, $refferer, $pagevisited, $useragent);}} function useJSON($url, $userkey, $apikey, $flash, $sendername, $messagetext, $recipients) {    $gsm = array();    $country_code = '234';    $arr_recipient = explode(',', $recipients);    foreach ($arr_recipient as $recipient) {        $mobilenumber = trim($recipient);        if (substr($mobilenumber, 0, 1) == '0'){            $mobilenumber = $country_code . substr($mobilenumber, 1);        }        elseif (substr($mobilenumber, 0, 1) == '+'){            $mobilenumber = substr($mobilenumber, 1);        }        $generated_id = uniqid('int_', false);        $generated_id = substr($generated_id, 0, 30);        $gsm['gsm'][] = array('msidn' => $mobilenumber, 'msgid' => $generated_id);    }    $message = array(        'sender' => $sendername,        'messagetext' => $messagetext,        'flash' => "{$flash}",    );     $request = array('SMS' => array(            'auth' => array(                'username' => $userkey,                'apikey' => $apikey            ),            'message' => $message,            'recipients' => $gsm    ));    $json_data = json_encode($request);    if ($json_data) {        $response = doPostRequest($url, $json_data, array('Content-Type: application/json'));        $result = json_decode($response);        return $result->response->status;    } else {        return false;    }} function useXML($url, $userkey, $apikey, $flash, $sendername, $messagetext, $recipients) {    $country_code = '234';    $arr_recipient = explode(',', $recipients);    $count = count($arr_recipient);    $msg_ids = array();    $recipients = '';     $xml = new SimpleXMLElement('<SMS></SMS>');    $auth = $xml->addChild('auth');    $auth->addChild('username', $userkey);    $auth->addChild('apikey', $apikey);     $msg = $xml->addChild('message');    $msg->addChild('sender', $sendername);    $msg->addChild('messagetext', $messagetext);    $msg->addChild('flash', $flash);     $rcpt = $xml->addChild('recipients');    for ($i = 0; $i < $count; $i++) {        $generated_id = uniqid('int_', false);        $generated_id = substr($generated_id, 0, 30);        $mobilenumber = trim($arr_recipient[$i]);        if (substr($mobilenumber, 0, 1) == '0') {            $mobilenumber = $country_code . substr($mobilenumber, 1);        } elseif (substr($mobilenumber, 0, 1) == '+') {            $mobilenumber = substr($mobilenumber, 1);        }        $gsm = $rcpt->addChild('gsm');        $gsm->addchild('msidn', $mobilenumber);        $gsm->addchild('msgid', $generated_id);    }    $xmlrequest = $xml->asXML();     if ($xmlrequest) {        $result = doPostRequest($url, $xmlrequest, array('Content-Type: application/xml'));        $xmlresponse = new SimpleXMLElement($result);        return $xmlresponse->status;    }    return false;} //Function to connect to SMS sending server using HTTP GETfunction useHTTPGet($url, $userkey, $apikey, $flash, $sendername, $messagetext, $recipients) {    $query_str = http_build_query(array('username' => $userkey, 'apikey' => $apikey, 'sender' => $sendername, 'messagetext' => $messagetext, 'flash' => $flash, 'recipients' => $recipients));    return file_get_contents("{$url}?{$query_str}");} //Function to connect to SMS sending server using HTTP POSTfunction doPostRequest($url, $arr_params, $headers = array('Content-Type: application/x-www-form-urlencoded')) {    $response = array();    $final_url_data = $arr_params;    if (is_array($arr_params)) {        $final_url_data = http_build_query($arr_params, '', '&');    }    $ch = curl_init();    curl_setopt($ch, CURLOPT_URL, $url);    curl_setopt($ch, CURLOPT_POSTFIELDS, $final_url_data);    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);    curl_setopt($ch, CURLOPT_POST, 1);    curl_setopt($ch, CURLOPT_NOSIGNAL, 1);    curl_setopt($ch, CURLOPT_VERBOSE, 1);    curl_setopt($ch, CURLOPT_TIMEOUT, 30);    $response['body'] = curl_exec($ch);    $response['code'] = curl_getinfo($ch, CURLINFO_HTTP_CODE);    curl_close($ch);    return $response['body'];} ?>